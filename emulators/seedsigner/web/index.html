<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>SeedSigner Emulator</title>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="description" content="Run SeedSigner in your browser. Practice Bitcoin self-custody without hardware.">
<meta property="og:title" content="SeedSigner Web Emulator">
<meta property="og:description" content="Run real SeedSigner firmware in your browser. Navigate menus, generate seeds, scan QR codes with your webcam. No hardware needed.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://github.com/Bitcoin-Butlers/bitcoin-self-custody">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="SeedSigner Web Emulator">
<meta name="twitter:description" content="Practice Bitcoin self-custody in your browser. Real firmware, no hardware.">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: #0a0a0a;
    color: #f5f5f5;
    font-family: system-ui, -apple-system, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
  }
  h1 {
    font-size: 1.2rem;
    color: #FBDC7B;
    margin-bottom: 1rem;
    text-align: center;
  }
  .emulator {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.5rem;
  }
  .device {
    background: #1a1a1a;
    border: 2px solid #333;
    border-radius: 16px;
    padding: 24px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 16px;
  }
  #screen {
    border: 2px solid #444;
    border-radius: 4px;
    image-rendering: pixelated;
  }
  .controls {
    display: flex;
    gap: 2rem;
    align-items: center;
  }
  .dpad {
    display: grid;
    grid-template-columns: 40px 40px 40px;
    grid-template-rows: 40px 40px 40px;
    gap: 2px;
  }
  .dpad button {
    width: 40px;
    height: 40px;
    border: 1px solid #555;
    border-radius: 6px;
    background: #2a2a2a;
    color: #f5f5f5;
    font-size: 1.2rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .dpad button:hover { background: #3a3a3a; }
  .dpad button:active, .dpad button.pressed { background: #FBDC7B; color: #000; }
  .dpad .empty { border: none; background: transparent; cursor: default; pointer-events: none; }
  .side-buttons {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  .side-buttons button {
    width: 50px;
    height: 36px;
    border: 1px solid #555;
    border-radius: 6px;
    background: #2a2a2a;
    color: #f5f5f5;
    font-size: 0.9rem;
    cursor: pointer;
  }
  .side-buttons button:hover { background: #3a3a3a; }
  .side-buttons button:active, .side-buttons button.pressed { background: #FBDC7B; color: #000; }
  .hint {
    color: #666;
    font-size: 0.8rem;
    text-align: center;
    max-width: 400px;
  }
  .status {
    font-size: 0.75rem;
    color: #444;
  }
  .status.connected { color: #10B981; }
  a { color: #FBDC7B; }
  .toolbar {
    display: flex;
    gap: 8px;
    margin-top: 4px;
  }
  .toolbar button {
    background: #2a2a2a;
    border: 1px solid #444;
    border-radius: 6px;
    color: #999;
    font-size: 0.75rem;
    padding: 4px 10px;
    cursor: pointer;
  }
  .toolbar button:hover { background: #3a3a3a; color: #f5f5f5; }
  .toolbar button.active { background: #FBDC7B; color: #000; }
  .main-layout {
    display: flex;
    gap: 1.5rem;
    align-items: flex-start;
  }
  .tutorial-panel {
    background: #1a1a1a;
    border: 2px solid #333;
    border-radius: 16px;
    padding: 20px;
    width: 260px;
    display: none;
    flex-direction: column;
    gap: 12px;
  }
  .tutorial-panel.visible { display: flex; }
  .tutorial-title {
    color: #FBDC7B;
    font-size: 0.95rem;
    font-weight: 600;
  }
  .tutorial-step-count {
    color: #666;
    font-size: 0.7rem;
  }
  .tutorial-instruction {
    font-size: 0.85rem;
    line-height: 1.5;
    min-height: 80px;
  }
  .tutorial-keys {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
  }
  .tutorial-keys kbd {
    background: #333;
    border: 1px solid #555;
    border-radius: 3px;
    padding: 2px 8px;
    font-family: monospace;
    font-size: 0.8rem;
    color: #FBDC7B;
  }
  .tutorial-nav {
    display: flex;
    justify-content: space-between;
    gap: 8px;
  }
  .tutorial-nav button {
    flex: 1;
    padding: 8px;
    border: 1px solid #444;
    border-radius: 6px;
    background: #2a2a2a;
    color: #f5f5f5;
    cursor: pointer;
    font-size: 0.8rem;
  }
  .tutorial-nav button:hover { background: #3a3a3a; }
  .tutorial-nav button:disabled { opacity: 0.3; cursor: default; }
  .tutorial-tip {
    font-size: 0.7rem;
    color: #666;
    font-style: italic;
  }
  .tutorial-menu {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  .tutorial-menu button {
    text-align: left;
    padding: 10px 12px;
    border: 1px solid #333;
    border-radius: 8px;
    background: #222;
    color: #f5f5f5;
    cursor: pointer;
    font-size: 0.85rem;
  }
  .tutorial-menu button:hover { border-color: #FBDC7B; }
  .tutorial-menu .tutorial-label {
    color: #666;
    font-size: 0.7rem;
  }
  @media (max-width: 600px) {
    .main-layout { flex-direction: column; align-items: center; }
    .tutorial-panel { width: 100%; max-width: 340px; }
  }
  .overlay {
    position: absolute;
    top: 0; left: 0;
    width: 240px; height: 240px;
    background: rgba(0,0,0,0.88);
    display: none;
    flex-direction: column;
    justify-content: center;
    padding: 16px;
    font-size: 0.75rem;
    line-height: 1.8;
    z-index: 10;
    border-radius: 4px;
  }
  .overlay.visible { display: flex; }
  .overlay kbd {
    background: #333;
    border: 1px solid #555;
    border-radius: 3px;
    padding: 1px 5px;
    font-family: monospace;
    font-size: 0.7rem;
    color: #FBDC7B;
  }
  .device { position: relative; }
  .camera-container {
    position: relative;
    width: 240px;
    height: 180px;
    border: 1px solid #333;
    border-radius: 8px;
    overflow: hidden;
    display: none;
  }
  .camera-container.active { display: block; }
  .camera-container video {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  .camera-label {
    position: absolute;
    bottom: 4px;
    left: 8px;
    font-size: 0.65rem;
    color: #10B981;
    background: rgba(0,0,0,0.7);
    padding: 2px 6px;
    border-radius: 4px;
  }
</style>
</head>
<body>
<div class="emulator">
  <h1>SeedSigner Emulator</h1>
  <div class="main-layout">
  <div class="device">
    <canvas id="screen" width="240" height="240"></canvas>
    <div class="overlay" id="help-overlay">
      <div><kbd>‚Üë</kbd> <kbd>‚Üì</kbd> <kbd>‚Üê</kbd> <kbd>‚Üí</kbd> Navigate</div>
      <div><kbd>Enter</kbd> Select</div>
      <div><kbd>1</kbd> Key 1 (top)</div>
      <div><kbd>2</kbd> Key 2 (middle)</div>
      <div><kbd>3</kbd> Key 3 (bottom)</div>
      <div><kbd>Esc</kbd> Back (same as key 3)</div>
      <div style="margin-top:8px;color:#666">Press <kbd>?</kbd> to close</div>
    </div>
    <div class="controls">
      <div class="dpad">
        <div class="empty"></div>
        <button id="btn-up">&#9650;</button>
        <div class="empty"></div>
        <button id="btn-left">&#9664;</button>
        <button id="btn-enter">OK</button>
        <button id="btn-right">&#9654;</button>
        <div class="empty"></div>
        <button id="btn-down">&#9660;</button>
        <div class="empty"></div>
      </div>
      <div class="side-buttons">
        <button id="btn-1">1</button>
        <button id="btn-2">2</button>
        <button id="btn-3">3</button>
      </div>
    </div>
  </div>
  <div class="tutorial-panel" id="tutorial-panel">
    <div id="tutorial-menu-view">
      <div class="tutorial-title">üìñ Tutorials</div>
      <p style="font-size:0.8rem;color:#999;margin:4px 0 12px">Learn by doing. Follow along step by step.</p>
      <div class="tutorial-menu" id="tutorial-menu"></div>
    </div>
    <div id="tutorial-step-view" style="display:none">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div class="tutorial-title" id="tutorial-name"></div>
        <button style="background:none;border:none;color:#666;cursor:pointer;font-size:1rem" id="tutorial-close">‚úï</button>
      </div>
      <div class="tutorial-step-count" id="tutorial-progress"></div>
      <div class="tutorial-instruction" id="tutorial-text"></div>
      <div class="tutorial-keys" id="tutorial-keys"></div>
      <div class="tutorial-tip" id="tutorial-tip"></div>
      <div class="tutorial-nav">
        <button id="tutorial-prev">‚Üê Back</button>
        <button id="tutorial-next">Next ‚Üí</button>
      </div>
    </div>
  </div>
  </div>
  <div class="camera-container" id="camera-container">
    <video id="camera" autoplay playsinline muted></video>
    <canvas id="camera-canvas" style="display:none"></canvas>
    <span class="camera-label">üì∑ Camera active</span>
  </div>
  <div class="toolbar">
    <button id="btn-help" title="Keyboard shortcuts">? Help</button>
    <button id="btn-tutorial" title="Interactive tutorials">üìñ Tutorial</button>
    <button id="btn-fullscreen" title="Fullscreen">‚õ∂ Fullscreen</button>
  </div>
  <p class="status" id="status">Connecting...</p>
  <p class="hint" style="margin-top: 1rem;">
    <a href="https://github.com/Bitcoin-Butlers/bitcoin-self-custody" target="_blank">Bitcoin Self-Custody Docs</a>
    &middot; Powered by <a href="https://bitcoinbutlers.com" target="_blank">Bitcoin Butlers</a>
  </p>
</div>

<script>
const canvas = document.getElementById('screen');
const ctx = canvas.getContext('2d');
const status = document.getElementById('status');

let ws;
let reconnectTimer;

function connect() {
  ws = new WebSocket(`ws://${location.hostname}:8889`);

  ws.onopen = () => {
    status.textContent = 'Connected';
    status.className = 'status connected';
  };

  ws.onmessage = (event) => {
    const data = JSON.parse(event.data);
    if (data.type === 'frame') {
      const img = new Image();
      img.onload = () => ctx.drawImage(img, 0, 0, 240, 240);
      img.src = 'data:image/png;base64,' + data.data;
    } else if (data.type === 'camera_status') {
      if (data.active && !cameraWasActive) {
        cameraWasActive = true;
        startCamera();
      } else if (!data.active && cameraWasActive) {
        cameraWasActive = false;
        stopCamera();
      }
    }
  };

  ws.onclose = () => {
    status.textContent = 'Disconnected. Reconnecting...';
    status.className = 'status';
    reconnectTimer = setTimeout(connect, 2000);
  };

  ws.onerror = () => ws.close();
}

function sendKey(key) {
  if (ws && ws.readyState === WebSocket.OPEN) {
    ws.send(JSON.stringify({ type: 'key', key }));
  }
}

// Help overlay
const helpOverlay = document.getElementById('help-overlay');
function toggleHelp() { helpOverlay.classList.toggle('visible'); }
document.getElementById('btn-help').addEventListener('click', toggleHelp);

// Fullscreen
document.getElementById('btn-fullscreen').addEventListener('click', () => {
  const el = document.querySelector('.emulator');
  if (document.fullscreenElement) {
    document.exitFullscreen();
  } else if (el.requestFullscreen) {
    el.requestFullscreen();
  } else if (el.webkitRequestFullscreen) {
    el.webkitRequestFullscreen();
  }
});
// Hide fullscreen button if not supported
if (!document.fullscreenEnabled && !document.webkitFullscreenEnabled) {
  document.getElementById('btn-fullscreen').style.display = 'none';
}

// Keyboard controls
document.addEventListener('keydown', (e) => {
  if (e.key === '?') { toggleHelp(); return; }
  if (e.key === 'Escape') { e.preventDefault(); sendKey('3'); return; }
  const validKeys = ['ArrowUp','ArrowDown','ArrowLeft','ArrowRight','Enter','1','2','3'];
  if (validKeys.includes(e.key)) {
    e.preventDefault();
    sendKey(e.key);
  }
});

// Button controls (mouse + touch)
const btnMap = {
  'btn-up': 'ArrowUp',
  'btn-down': 'ArrowDown',
  'btn-left': 'ArrowLeft',
  'btn-right': 'ArrowRight',
  'btn-enter': 'Enter',
  'btn-1': '1',
  'btn-2': '2',
  'btn-3': '3',
};
for (const [id, key] of Object.entries(btnMap)) {
  const btn = document.getElementById(id);
  btn.addEventListener('mousedown', () => sendKey(key));
  btn.addEventListener('touchstart', (e) => {
    e.preventDefault();
    btn.classList.add('pressed');
    sendKey(key);
  });
  btn.addEventListener('touchend', () => btn.classList.remove('pressed'));
}

// Loading state
ctx.fillStyle = '#1a1a1a';
ctx.fillRect(0, 0, 240, 240);
ctx.fillStyle = '#666';
ctx.font = '14px system-ui';
ctx.textAlign = 'center';
ctx.fillText('Waiting for SeedSigner...', 120, 120);

// Camera handling
const cameraVideo = document.getElementById('camera');
const cameraCanvas = document.getElementById('camera-canvas');
const cameraContainer = document.getElementById('camera-container');
const cameraCtx = cameraCanvas.getContext('2d');
let cameraStream = null;
let cameraInterval = null;
let cameraWasActive = false;

async function startCamera() {
  if (cameraStream) return;
  try {
    cameraStream = await navigator.mediaDevices.getUserMedia({
      video: { facingMode: 'environment', width: 640, height: 480 },
      audio: false,
    });
    cameraVideo.srcObject = cameraStream;
    cameraContainer.classList.add('active');
    cameraCanvas.width = 640;
    cameraCanvas.height = 480;

    // Send frames at ~10fps
    cameraInterval = setInterval(() => {
      if (ws && ws.readyState === WebSocket.OPEN) {
        cameraCtx.drawImage(cameraVideo, 0, 0, 640, 480);
        const dataUrl = cameraCanvas.toDataURL('image/jpeg', 0.7);
        const base64 = dataUrl.split(',')[1];
        ws.send(JSON.stringify({ type: 'camera_frame', data: base64 }));
      }
    }, 100);
  } catch (e) {
    console.warn('Camera access denied or unavailable:', e);
  }
}

function stopCamera() {
  if (cameraInterval) { clearInterval(cameraInterval); cameraInterval = null; }
  if (cameraStream) {
    cameraStream.getTracks().forEach(t => t.stop());
    cameraStream = null;
  }
  cameraContainer.classList.remove('active');
}

// Tutorial system
const tutorials = [
  {
    id: 'generate-seed',
    name: 'Generate a Seed Phrase',
    description: 'Create a new 12-word seed phrase from scratch.',
    steps: [
      { text: "You should see the SeedSigner main menu. Use the arrow keys or on-screen buttons to navigate.", keys: [], tip: "If the screen says 'Waiting for SeedSigner...', wait a few seconds for the firmware to load." },
      { text: "Navigate down to 'Seeds' and press Enter to select it.", keys: ['‚Üì', 'Enter'], tip: "Seeds is the second item in the main menu." },
      { text: "You'll see the Seeds menu. Select 'Create a seed' by pressing Enter.", keys: ['Enter'], tip: "" },
      { text: "Choose '12 words' or '24 words'. For this tutorial, select 12 words.", keys: ['Enter'], tip: "12 words is standard for most use cases. 24 words adds extra entropy but isn't strictly necessary." },
      { text: "SeedSigner needs randomness to generate your seed. Select 'Calculator' for the simplest method.", keys: ['Enter'], tip: "On a real device, you'd use dice rolls or the camera for better entropy. The calculator method uses the device's built-in randomness." },
      { text: "Your seed phrase is being generated! SeedSigner will show you 12 words, one screen at a time.", keys: ['Enter'], tip: "On a real device, you'd write each word on paper or stamp it into steel. NEVER type seed words into a computer." },
      { text: "Press Enter to advance through each word. Read them carefully.", keys: ['Enter'], tip: "The order matters. Word #1 must stay word #1." },
      { text: "After viewing all words, SeedSigner will quiz you to verify you wrote them down correctly.", keys: ['‚Üë', '‚Üì', 'Enter'], tip: "This verification step exists because getting even one word wrong means losing your Bitcoin forever." },
      { text: "Complete the verification quiz by selecting the correct word for each position.", keys: ['‚Üë', '‚Üì', 'Enter'], tip: "Take your time. On a real device, check your written backup." },
      { text: "Congratulations! You've generated a seed phrase. On a real SeedSigner, you'd now export the public key to a wallet like Sparrow.", keys: [], tip: "‚ö†Ô∏è This was practice. Never use a seed generated in an emulator for real Bitcoin." },
    ]
  },
  {
    id: 'explore-settings',
    name: 'Explore Settings',
    description: 'Learn what each setting does.',
    steps: [
      { text: "From the main menu, navigate to 'Settings' and press Enter.", keys: ['‚Üì', 'Enter'], tip: "Settings is near the bottom of the main menu." },
      { text: "Browse through the settings categories. Each controls a different aspect of the device.", keys: ['‚Üë', '‚Üì', 'Enter'], tip: "" },
      { text: "Try 'Display' ‚Äî you can change the screen brightness and orientation.", keys: ['Enter'], tip: "On a real device, higher brightness drains the battery faster." },
      { text: "Press key 3 (or the back button) to go back to the settings menu.", keys: ['3'], tip: "Key 3 is always 'back' in SeedSigner." },
      { text: "Check out 'Advanced' for network settings (mainnet vs testnet) and other power-user options.", keys: ['‚Üì', 'Enter'], tip: "For learning, testnet is safer. For real Bitcoin, always use mainnet." },
      { text: "You've explored the settings! Press key 3 repeatedly to return to the main menu.", keys: ['3'], tip: "Now you know where everything is when you get your real device." },
    ]
  },
  {
    id: 'sign-transaction',
    name: 'Sign a Transaction',
    description: 'Load a seed and sign a PSBT via QR code.',
    steps: [
      { text: "This tutorial walks through signing a transaction using a seed phrase. First, go to 'Seeds' from the main menu.", keys: ['‚Üì', 'Enter'], tip: "In real use, you'd load your existing seed. Here we'll create a temporary one." },
      { text: "Select 'Create a seed' and generate a 12-word seed (same as the first tutorial).", keys: ['Enter'], tip: "Remember: this is a test seed. Never use emulator seeds for real Bitcoin." },
      { text: "After generating and verifying your seed, SeedSigner saves it in memory for this session.", keys: ['Enter'], tip: "SeedSigner never stores seeds permanently. When you power off, the seed is gone." },
      { text: "Now go back to the main menu. You should see a new option: 'Scan'.", keys: ['3', '3'], tip: "The Scan option appears once you have a seed loaded." },
      { text: "Select 'Scan'. SeedSigner will activate the camera to scan a QR code.", keys: ['Enter'], tip: "In the emulator, your webcam will activate. On a real device, the built-in camera turns on." },
      { text: "In your wallet app (Bull Bitcoin wallet for single-sig, or Sparrow for multisig), create a transaction and show the QR code. Hold it up to your webcam.", keys: [], tip: "If you don't have a wallet set up yet, that's OK. You can try this step later. For now, press key 3 to go back." },
      { text: "SeedSigner reads the PSBT (Partially Signed Bitcoin Transaction), shows you the details, and asks you to confirm.", keys: ['‚Üë', '‚Üì'], tip: "Always verify: the recipient address, the amount, and the fee. On a real device, this is your last chance to catch errors." },
      { text: "After confirming, SeedSigner signs the transaction and displays a QR code. Scan this with your wallet app to broadcast.", keys: ['Enter'], tip: "The signed transaction never touches the internet until your wallet broadcasts it. That's the air gap in action." },
      { text: "You've completed an air-gapped transaction signing! This is how Bitcoin self-custody works in practice.", keys: [], tip: "The full flow: Wallet creates TX ‚Üí QR to SeedSigner ‚Üí SeedSigner signs ‚Üí QR back to wallet ‚Üí wallet broadcasts." },
    ]
  },
  {
    id: 'export-xpub',
    name: 'Export Public Key to Wallet',
    description: 'Connect SeedSigner to your wallet app.',
    steps: [
      { text: "First, load or create a seed (see the 'Generate a Seed Phrase' tutorial if you haven't).", keys: [], tip: "You need an active seed before you can export its public key." },
      { text: "From the main menu, go to 'Seeds' and select your loaded seed.", keys: ['‚Üì', 'Enter'], tip: "" },
      { text: "Select 'Export Xpub' from the seed options.", keys: ['‚Üì', 'Enter'], tip: "Xpub = extended public key. It lets your wallet generate receive addresses and track your balance WITHOUT the ability to spend." },
      { text: "Choose the wallet type. For a standard single-sig wallet, select 'Single Sig'. For multisig, select 'Multisig'.", keys: ['Enter'], tip: "Single sig = one key needed to spend (use Bull Bitcoin wallet). Multisig = multiple keys needed (use Sparrow)." },
      { text: "Choose the script type. Select 'Native Segwit' (the default and most common).", keys: ['Enter'], tip: "Native Segwit (bc1q...) has the lowest transaction fees." },
      { text: "SeedSigner displays a QR code containing your xpub. Open your wallet app and scan this QR code to import the public key.", keys: [], tip: "In Bull Bitcoin wallet: scan the QR during wallet setup. In Sparrow: File ‚Üí New Wallet ‚Üí Connected Hardware Wallet ‚Üí Scan." },
      { text: "Your wallet now has your public key and can generate receive addresses. SeedSigner is only needed when you want to SPEND.", keys: [], tip: "This is the air-gapped model: your wallet watches, SeedSigner signs." },
      { text: "Done! You can receive Bitcoin to the addresses your wallet generates, and sign spending transactions with SeedSigner.", keys: [], tip: "For extra security, verify that the first receive address matches on both your wallet and SeedSigner." },
    ]
  }
];

const tutorialPanel = document.getElementById('tutorial-panel');
const tutorialMenu = document.getElementById('tutorial-menu');
const tutorialMenuView = document.getElementById('tutorial-menu-view');
const tutorialStepView = document.getElementById('tutorial-step-view');
const tutorialName = document.getElementById('tutorial-name');
const tutorialProgress = document.getElementById('tutorial-progress');
const tutorialText = document.getElementById('tutorial-text');
const tutorialKeys = document.getElementById('tutorial-keys');
const tutorialTip = document.getElementById('tutorial-tip');
const tutorialPrev = document.getElementById('tutorial-prev');
const tutorialNext = document.getElementById('tutorial-next');
const tutorialClose = document.getElementById('tutorial-close');
const tutorialBtn = document.getElementById('btn-tutorial');

let currentTutorial = null;
let currentStep = 0;

// Build tutorial menu
tutorials.forEach(t => {
  const btn = document.createElement('button');
  btn.innerHTML = `${t.name}<br><span class="tutorial-label">${t.description}</span>`;
  btn.addEventListener('click', () => startTutorial(t));
  tutorialMenu.appendChild(btn);
});

function toggleTutorial() {
  tutorialPanel.classList.toggle('visible');
  tutorialBtn.classList.toggle('active');
  if (!tutorialPanel.classList.contains('visible')) {
    currentTutorial = null;
    tutorialMenuView.style.display = '';
    tutorialStepView.style.display = 'none';
  }
}

function startTutorial(t) {
  currentTutorial = t;
  currentStep = 0;
  tutorialMenuView.style.display = 'none';
  tutorialStepView.style.display = '';
  tutorialName.textContent = t.name;
  renderStep();
}

function renderStep() {
  const step = currentTutorial.steps[currentStep];
  tutorialProgress.textContent = `Step ${currentStep + 1} of ${currentTutorial.steps.length}`;
  tutorialText.textContent = step.text;
  tutorialKeys.innerHTML = step.keys.map(k => `<kbd>${k}</kbd>`).join('');
  tutorialTip.textContent = step.tip || '';
  tutorialPrev.disabled = currentStep === 0;
  tutorialNext.textContent = currentStep === currentTutorial.steps.length - 1 ? 'Done ‚úì' : 'Next ‚Üí';
}

tutorialBtn.addEventListener('click', toggleTutorial);
tutorialClose.addEventListener('click', () => {
  currentTutorial = null;
  tutorialMenuView.style.display = '';
  tutorialStepView.style.display = 'none';
});
tutorialPrev.addEventListener('click', () => { if (currentStep > 0) { currentStep--; renderStep(); } });
tutorialNext.addEventListener('click', () => {
  if (currentStep < currentTutorial.steps.length - 1) { currentStep++; renderStep(); }
  else { tutorialClose.click(); }
});

connect();
</script>
</body>
</html>